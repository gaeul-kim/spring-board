<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="article">
	<select id="selectArticles" parameterType="sampleProject.article.domain.Article"
		resultType="sampleProject.article.domain.Article">
		<![CDATA[
		    select a.articleId, a.articleTitle, a.articleWriter, m.memberName articleWriterName, date_format(a.articleInsertDate,'%Y-%m-%d') articleInsertDate, a.articleHit, a.articleCategory
		        from article a 
		          inner join member m on a.articleWriter = m.memberId
		            where articleDeleteDate is null 
		                and articleCategory = #{articleCategory}
		                  order by articleId desc
		                  
		                  
		                  
	    ]]>
	</select>
	<select id="selectArticle" parameterType="sampleProject.article.domain.Article"
		resultType="sampleProject.article.domain.Article">
        <![CDATA[
            select 
                a.articleId, a.articleTitle, a.articleContent, a.articleWriter,  m.memberName articleWriterName, date_format(a.articleInsertDate,'%Y-%m-%d %H:%i') articleInsertDate, a.articleHit, a.articleCategory
                    from article a
                         inner join member m on a.articleWriter = m.memberId
                            where articleDeleteDate is null 
                                and articleId = #{articleId}
        ]]>
	</select>
	<update id="updateHit" parameterType="sampleProject.article.domain.Article">
        <![CDATA[
            update article
                set articleHit = articleHit+1
                    where articleId = #{articleId}
                        and articleDeleteDate is null               
        ]]>
	</update>
	<insert id="insertArticle" parameterType="sampleProject.article.domain.Article"
		useGeneratedKeys="true" keyProperty="articleId">
	   <![CDATA[
            insert into article
                (articleTitle, articleContent, articleWriter, articleCategory, articleInsertDate)
                    values(#{articleTitle}, #{articleContent}, #{articleWriter}, #{articleCategory}, now())
        ]]>
	</insert>

	<update id="updateDeleteDate" parameterType="sampleProject.article.domain.Article">
        <![CDATA[
        update article 
            set articleDeleteDate = now()
                where articleId = #{articleId}
        ]]>
	</update>

	<update id="updateArticle" parameterType="sampleProject.article.domain.Article">
	<![CDATA[
	   update article
	       set(articleTitle, articleContent, articleCategory)
	           values(#{articleTitle}, #{articleContent}, #{articleCategory})
	               where articleId = #{articleId}
	]]>

	</update>

	<select id="selectArticleCategory" parameterType="String"
		resultType="Integer">
    <![CDATA[
        select count(*) from article_category where categoryName = #{articleCategory}
    ]]>
	</select>
	<select id="selectArticleTags" parameterType="String"
		resultType="String">
	<![CDATA[
        select tagName from article_tag 
            where categoryId = 
                (select categoryId from article_category where categoryName = #{articleCategory});	
    ]]>
	</select>
</mapper>
