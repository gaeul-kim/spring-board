<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="article">
	<select id="selectArticles" parameterType="sampleProject.article.domain.Article"
		resultType="sampleProject.article.domain.Article">
		<![CDATA[
		    select articleId, articleTitle, articleWriter, articleInsertDate, articleHit, articleCategory
		        from article 
		            where articleDeleteDate is null 
		                and articleCategory = #{articleCategory}
	    ]]>
	</select>
	<select id="selectArticle" parameterType="sampleProject.article.domain.Article"
		resultType="sampleProject.article.domain.Article">
        <![CDATA[
            select 
                articleId, articleTitle, articleContent, articleWriter, articleInsertDate, articleHit, articleCategory
                    from article
                        where articleDeleteDate is null 
                            and articleId = #{articleId}
        ]]>
	</select>
	<update id="updateHit" parameterType="sampleProject.article.domain.Article">
        <![CDATA[
            update article
                set articleHit = articleHit+1
                    where articleId = #{articleId}
                        and articleDeleteDate is null               
        ]]>
	</update>
	<insert id="insertArticle" parameterType="sampleProject.article.domain.Article"
		useGeneratedKeys="true" keyProperty="articleId">
	   <![CDATA[
            insert into article
                (articleTitle, articleContent, articleWriter, articlePassword, articleCategory)
                    values(#{articleTitle}, #{articleContent}, #{articleWriter}, #{articlePassword},#{articleCategory})
        ]]>
	</insert>

	<update id="updateDeleteDate" parameterType="sampleProject.article.domain.Article">
        <![CDATA[
        update article 
            set articleDeleteDate = now()
                where articleId = #{articleId}
        ]]>
	</update>

	<update id="updateArticle" parameterType="sampleProject.article.domain.Article">
	<![CDATA[
	   update article
	       set(articleTitle, articleContent, articleCategory)
	           values(#{articleTitle}, #{articleContent}, #{articleCategory})
	               where articleId = #{articleId}
	]]>

	</update>

	<select id="selectArticleCategory" parameterType="String"
		resultType="Integer">
    <![CDATA[
        select count(*) from category where categoryName = #{articleCategory}
    ]]>
	</select>
	<select id="selectArticleCategories" parameterType="String"
		resultType="String">
	<![CDATA[
        select tagName from tag 
            where categoryId = 
                (select categoryId from category where categoryName = #{articleCategory});	
    ]]>
	</select>
</mapper>
